{% extends "base.html" %}

{% block title %}Доступная недвижимость{% endblock %}

{% block content %}

<div>
    <h1>Доступная недвижимость</h1>

    {% if user.is_authenticated %}

    <form method="get">
        <input type="text" name="search" placeholder="Поиск по адресу, описанию или категории..." value="{{ search_query }}">
        <button type="submit">Поиск</button>

        <select name="category">
            <option value="">Все категории</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>
                {{ cat }}
                </option>
            {% endfor %}
        </select>

        <select name="service_category">
            <option value="">Все виды категорий</option>
            {% for sc in service_categories %}
                <option value="{{ sc.id }}" {% if request.GET.service_category == sc.id|stringformat:"s" %}selected{% endif %}>
                {{ sc }}
                </option>
            {% endfor %}
        </select>

        <select name="sort">
            <option value="">Сортировка</option>
            <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>
            Цена (по возрастанию)
            </option>
            <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>
            Цена (по убыванию)
            </option>
            <option value="area_asc" {% if request.GET.sort == 'area_asc' %}selected{% endif %}>
            Площадь (по возрастанию)
            </option>
            <option value="area_desc" {% if request.GET.sort == 'area_desc' %}selected{% endif %}>
            Площадь (по убыванию)
            </option>
        </select>

        <input type="number" name="min_price" placeholder="Цена от" value="{{ request.GET.min_price }}">
        <input type="number" name="max_price" placeholder="Цена до" value="{{ request.GET.max_price }}">
        <button type="submit">Применить</button>
    </form>

    {% for estate in estate_list %}
        <div>
            <img src="{{ estate.get_image_url }}" alt="{{ estate.title }}">
            <h3>{{ estate.address }}</h3>
            {% if estate.category %}
                {{ estate.category }}
            {% endif %}
            <p>Цена: {{ estate.cost }} $</p>
            <p>{{ estate.description }}</p>
            <a href="{% url 'estate_detail' estate.pk %}">Подробнее</a>
        </div>
    {% empty %}
        В данный момент нет доступных объектов недвижимости
    {% endfor %}
    {% else %}
        Чтобы просмотреть страницу, пожалуйста, <a href="{% url 'login' %}">войдите</a> или <a href="{% url 'signup' %}">зарегистрируйтесь</a>.
    {% endif %}
</div>
{% endblock %}